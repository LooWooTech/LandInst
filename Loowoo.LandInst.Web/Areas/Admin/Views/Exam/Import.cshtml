@using Loowoo.LandInst.Model
@{
    ViewBag.Title = "批量导入成绩";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
    List<Exam> exams = ViewBag.Exams;
}

<form id="exam-form" action="?" role="form" class="form-horizontal" method="post" enctype="multipart/form-data" target="_uploadframe">
    <div class="form-group">
        <label class="control-label col-lg-2">选择考试</label>
        <div class="col-sm-3">
            <select name="examId" class="form-control input-sm">
                @foreach (var exam in exams)
                { 
                    <option value="@(exam.ID)">@(exam.Name)</option>
                }
            </select>
        </div>
    </div>
    <div class="form-group">
        <label class="control-label col-lg-2">选择Excel文件</label>
        <div class="col-sm-3">
            <input type="file" name="file" class="form-control" />
        </div>
    </div>
    <div class="form-group">
        <label class="control-label col-lg-2"></label>
        <div class="col-sm-3">
            <button type="submit" class="btn btn-primary"><i class="glyphicon glyphicon-upload"></i>上传导入</button>
        </div>
    </div>
</form>
<iframe id="_uploadframe" name="_uploadframe" width="0" height="0" frameborder="0"></iframe>
<script>
    $(function () {
        $("#_uploadframe").load(function () {
            var content = $(this).contents().find("body").html();
            if (content) {
                var json = eval("(" + content + ")");
                if (json.result) {
                    alert("导入完成");
                    window.location.href = "ExamResult";
                } else {
                    alert("导入失败");
                }
            }
        });
    });
</script>
