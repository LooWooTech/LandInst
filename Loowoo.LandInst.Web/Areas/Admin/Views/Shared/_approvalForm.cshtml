@using Loowoo.LandInst.Model
@using Loowoo.LandInst.Common
@{
    CheckLog approval = Model;
}
@if (approval != null)
{
    var user = Loowoo.LandInst.Manager.ManagerCore.Instance.UserManager.GetUser(approval.UserID);

    <legend>审批</legend>
    <div class="alert alert-dismissable alert-warning">
        该@(user.Role.GetDescription())于@(approval.CreateTime.ToShortDateString())申请了 
        <span class="label label-default">@(approval.CheckType.GetDescription())</span>，目前
            @if (approval.Result.HasValue)
            {
                <span>并且与@(approval.UpdateTime.Value.ToShortDateString())</span>
                if (approval.Result.Value)
                {
                <span class="label label-success">通过审核</span>
                }
                else
                {
                <span class="label label-warning">未通过审核</span>
                }
            }
            else
            {
                <span class="label label-default">尚未审批</span>
                
            }
    </div>
    if (!approval.Result.HasValue)
    { 
        <div class="well">
            <form id="approval-form" role="form" class="form-horizontal">
                <input id="approval-result" type="hidden" name="Result" value="" />
                <div class="form-group">
                    <label class="control-label col-lg-2">审批意见</label>
                    <div class="col-sm-3">
                        <textarea name="Note" rows="4" cols="50"></textarea>
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label col-lg-2"></label>
                    <div class="col-sm-3">
                        <input id="btn-agree" type="submit" value="通过审批" class="btn btn-sm btn-success" />
                        <input id="btn-disagree" type="submit" value="不通过" class="btn btn-sm btn-warning" />
                    </div>
                </div>
            </form>
        </div>
    }
    <script>
        $(function () {

            $("#btn-agree").click(function () {
                $("#approval-result").val("true");
            });

            $("#btn-disagree").click(function () {
                $("#approval-result").val("false");
            });

            $("#approval-form").submit(function () {
                var data = $(this).serialize();
                $.request("/admin/@(user.Role.ToString())/approval?id=@(approval.ID)", data, function () {
                    alert("审批完成！");
                    window.location.href = "@Html.Raw(Request.Url.AbsoluteUri)"

                });
                return false;
            });
        });
    </script>
}