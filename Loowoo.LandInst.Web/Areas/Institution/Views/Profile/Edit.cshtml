@using Loowoo.LandInst.Model
@{
    ViewBag.Title = "资料变更登记";
    Layout = "~/Areas/Institution/Views/Shared/_Layout.cshtml";
    CheckLog approval = ViewBag.CheckLog;
    InstitutionProfile model = ViewBag.Profile;
    //如果已提交还没审核，则不可以修改资
    var disabled = approval != null && !approval.Result.HasValue;
    //注册登记可以全部编辑
    var fullEdit = model.Status == InstitutionStatus.Normal && !disabled;

    Html.RenderPartial("_ProfileForm", model);
}
<script>
    $(function () {
        $("#btn-submit").click(function () {
            $("#submit-mode").val("submit");
            submitForm();
        });

        $("#btn-save").click(function () {
            $("#submit-mode").val("save");
            submitForm();
        });

        $("#profile-form").submit(function () {
            var data = $(this).serialize();
            var saveMode = $("#submit-mode").val();
            $.post("/institution/profile/edit?mode=" + saveMode, data, function (json) {
                if (json.result) {
                    if (saveMode == "submit") {
                        alert("资料已提交，请等待审核");
                    } else {
                        alert("资料已保存");
                    }
                    window.location.href = window.location.href;
                }
            }, "json");
            return false;
        });

        function submitForm() {
            $("#profile-form").submit();
        }

    });
</script>
